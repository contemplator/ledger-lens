<div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-8">
  <div class="flex items-center justify-between mb-8">
    <h2
      class="text-2xl font-bold leading-7 text-gray-900 sm:truncate sm:text-3xl sm:tracking-tight"
    >
      總覽看板
    </h2>
    <div class="flex items-center gap-3">
      <button
        pButton
        icon="pi pi-upload"
        label="重新上傳"
        class="p-button-outlined p-button"
        (click)="openUploadDialog()"
      ></button>
      <div class="flex items-center gap-3">
        <div
          class="flex items-center bg-white px-4 py-2 rounded-lg shadow-sm border border-gray-200"
        >
          <button
            (click)="prevMonth()"
            class="p-1 hover:bg-gray-100 rounded-full transition-colors mr-2 focus:outline-none"
            aria-label="上個月"
          >
            <i class="pi pi-chevron-left text-gray-600 text-sm"></i>
          </button>
          <i class="pi pi-calendar text-indigo-600 mr-2"></i>
          <span class="text-lg font-semibold text-gray-700 min-w-24 text-center"
            >{{ currentYear() }} 年 {{ currentMonth() }} 月</span
          >
          <button
            (click)="nextMonth()"
            class="p-1 hover:bg-gray-100 rounded-full transition-colors ml-2 focus:outline-none"
            aria-label="下個月"
          >
            <i class="pi pi-chevron-right text-gray-600 text-sm"></i>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- 摘要卡片區 -->
  <div class="grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-4 mb-8">
    <!-- 總支出 -->
    <div class="overflow-hidden rounded-lg bg-white shadow">
      <div class="p-5">
        <div class="flex items-center">
          <div class="shrink-0">
            <i class="pi pi-wallet text-red-500 text-3xl"></i>
          </div>
          <div class="ml-5 w-0 flex-1">
            <dl>
              <dt class="truncate text-sm font-medium text-gray-500">總支出</dt>
              <dd>
                <div class="text-lg font-medium text-gray-900">{{ totalExpense() | number }}</div>
              </dd>
            </dl>
          </div>
        </div>
      </div>
    </div>

    <!-- 總收入 -->
    <div class="overflow-hidden rounded-lg bg-white shadow">
      <div class="p-5">
        <div class="flex items-center">
          <div class="shrink-0">
            <i class="pi pi-money-bill text-green-500 text-3xl"></i>
          </div>
          <div class="ml-5 w-0 flex-1">
            <dl>
              <dt class="truncate text-sm font-medium text-gray-500">總收入</dt>
              <dd>
                <div class="text-lg font-medium text-gray-900">{{ totalIncome() | number }}</div>
              </dd>
            </dl>
          </div>
        </div>
      </div>
    </div>

    <!-- 結餘 -->
    <div class="overflow-hidden rounded-lg bg-white shadow">
      <div class="p-5">
        <div class="flex items-center">
          <div class="shrink-0">
            <i class="pi pi-dollar text-blue-500 text-3xl"></i>
          </div>
          <div class="ml-5 w-0 flex-1">
            <dl>
              <dt class="truncate text-sm font-medium text-gray-500">結餘</dt>
              <dd>
                <div
                  class="text-lg font-medium text-gray-900"
                  [class.text-red-600]="balance() < 0"
                  [class.text-green-600]="balance() >= 0"
                >
                  {{ balance() | number }}
                </div>
              </dd>
            </dl>
          </div>
        </div>
      </div>
    </div>

    <!-- 交易筆數 -->
    <div class="overflow-hidden rounded-lg bg-white shadow">
      <div class="p-5">
        <div class="flex items-center">
          <div class="shrink-0">
            <i class="pi pi-list text-purple-500 text-3xl"></i>
          </div>
          <div class="ml-5 w-0 flex-1">
            <dl>
              <dt class="truncate text-sm font-medium text-gray-500">交易筆數</dt>
              <dd>
                <div class="text-lg font-medium text-gray-900">{{ transactionCount() }}</div>
              </dd>
            </dl>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 圖表區 -->
  <div class="grid grid-cols-1 gap-8 lg:grid-cols-2">
    <!-- 支出分類圓餅圖 -->
    <div class="bg-white overflow-hidden shadow rounded-lg">
      <div class="px-4 py-5 sm:p-6">
        <h3 class="text-lg font-medium leading-6 text-gray-900 mb-4">支出分類佔比</h3>
        <div class="h-80">
          <p-chart type="doughnut" [data]="categoryChartData()" [options]="chartOptions"></p-chart>
        </div>
      </div>
    </div>

    <!-- 支出趨勢折線圖 -->
    <div class="bg-white overflow-hidden shadow rounded-lg">
      <div class="px-4 py-5 sm:p-6">
        <h3 class="text-lg font-medium leading-6 text-gray-900 mb-4">近六個月支出趨勢</h3>
        <div class="h-80">
          <p-chart type="line" [data]="trendChartData()" [options]="chartOptions"></p-chart>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- 上傳交易資料對話框 -->
<p-dialog
  header="上傳交易紀錄"
  [(visible)]="showUploadDialog"
  [modal]="true"
  [closable]="!isFirstUpload()"
  [dismissableMask]="!isFirstUpload()"
  [style]="{ width: '500px' }"
>
  <div class="text-center mb-4">
    <i class="pi pi-file-import text-indigo-500 mb-4" [style]="{ fontSize: '3rem' }"></i>
    @if (isFirstUpload()) {
    <p class="text-gray-600 mb-4">
      尚未上傳任何交易紀錄。<br />
      請上傳您的 CSV 檔案以開始使用。
    </p>
    } @else {
    <p class="text-gray-600 mb-4">請上傳您的 CSV 檔案以取代現有資料。</p>
    }
  </div>
  <app-file-dropzone></app-file-dropzone>
</p-dialog>
