<div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-8">
  <!-- 篩選器區塊 -->
  <div class="mb-6">
    <div class="flex justify-between sm:flex-row gap-4">
      <div class="w-full sm:w-1/3">
        <p-iconField iconPosition="left">
          <p-inputIcon class="pi pi-search" />
          <input
            type="text"
            pInputText
            [(ngModel)]="keyword"
            placeholder="搜尋備註、類別、帳戶或金額..."
            class="w-full"
          />
        </p-iconField>
      </div>
      
      <!-- Toggle Button -->
      <div class="flex gap-2">
          <p-button 
            [label]="showAdvancedFilters() ? '隱藏進階篩選' : '進階篩選'" 
            [icon]="showAdvancedFilters() ? 'pi pi-filter-slash' : 'pi pi-filter'" 
            (onClick)="toggleAdvancedFilters()"
            styleClass="p-button-outlined">
          </p-button>
          <p-button 
            label="清除" 
            icon="pi pi-times" 
            (onClick)="clearFilters()"
            styleClass="p-button-outlined p-button-secondary">
          </p-button>
      </div>
    </div>

    <!-- Advanced Filters Panel -->
    @if (showAdvancedFilters()) {
        <div class="mt-4 p-4 bg-gray-50 rounded-xl border border-gray-200 grid grid-cols-1 md:grid-cols-2 gap-4">
            
            <!-- Type -->
            <div class="flex flex-col gap-2">
                <label class="text-sm font-medium text-gray-700">交易類型</label>
                <p-selectButton 
                    [options]="typeOptions" 
                    [(ngModel)]="selectedType" 
                    optionLabel="label" 
                    optionValue="value">
                </p-selectButton>
            </div>

            <!-- Category -->
            <div class="flex flex-col gap-2">
                <label class="text-sm font-medium text-gray-700">分類</label>
                <p-multiSelect 
                    [options]="categoryOptions()" 
                    [(ngModel)]="selectedCategories" 
                    defaultLabel="選擇分類" 
                    [group]="true"
                    optionGroupLabel="label"
                    optionGroupChildren="items"
                    optionLabel="label" 
                    optionValue="value"
                    display="chip"
                    [style]="{'width':'100%'}">
                </p-multiSelect>
            </div>

            <!-- Date Range -->
            <div class="flex flex-col gap-2 md:col-span-2 lg:col-span-1">
                <label class="text-sm font-medium text-gray-700">日期範圍</label>
                <div class="flex gap-2 items-center">
                    <div class="flex-1 min-w-0">
                        <p-datepicker 
                            [(ngModel)]="startDate" 
                            placeholder="開始日期" 
                            dateFormat="yy/mm/dd" 
                            [showIcon]="true"
                            styleClass="w-full"
                            [inputStyle]="{'width':'100%'}">
                        </p-datepicker>
                    </div>
                    <span class="text-gray-400 shrink-0">-</span>
                    <div class="flex-1 min-w-0">
                        <p-datepicker 
                            [(ngModel)]="endDate" 
                            placeholder="結束日期" 
                            dateFormat="yy/mm/dd" 
                            [showIcon]="true"
                            styleClass="w-full"
                            [inputStyle]="{'width':'100%'}">
                        </p-datepicker>
                    </div>
                </div>
            </div>

            <!-- Amount Range -->
            <div class="flex flex-col gap-2 md:col-span-2 lg:col-span-1">
                <label class="text-sm font-medium text-gray-700">金額範圍</label>
                <div class="flex gap-2 items-center">
                    <p-inputNumber 
                        [(ngModel)]="minAmount" 
                        placeholder="最小" 
                        mode="currency" 
                        currency="TWD" 
                        locale="zh-TW"
                        [minFractionDigits]="0"
                        styleClass="w-full">
                    </p-inputNumber>
                    <span class="text-gray-400">-</span>
                    <p-inputNumber 
                        [(ngModel)]="maxAmount" 
                        placeholder="最大" 
                        mode="currency" 
                        currency="TWD" 
                        locale="zh-TW"
                        [minFractionDigits]="0"
                        styleClass="w-full">
                    </p-inputNumber>
                </div>
            </div>
        </div>
    }
  </div>

  <!-- 交易表格 -->
  <div class="bg-white shadow-sm ring-1 ring-gray-900/5 sm:rounded-xl md:col-span-2">
    <app-transaction-table [transactions]="filteredTransactions()"></app-transaction-table>
  </div>
</div>
